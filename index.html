<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | Test TG</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval' 'unsafe-inline' https://telegram.org; connect-src 'self' http://45.12.229.33:8080;">
    <style>
      html, body { padding: 0; margin: 0; overflow: hidden; }
      #unity-canvas { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; }
    </style>
  </head>
  <body>
    <canvas id="unity-canvas" tabindex="-1"></canvas>
    <script src="Build/TG-test-build.loader.js"></script>
    <script>
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/TG-test-build.data",
        frameworkUrl: "Build/TG-test-build.framework.js",
        codeUrl: "Build/TG-test-build.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Test TG",
        productVersion: "1.0",
      }).then((unity) => {
        // Сохраняем глобальную ссылку на экземпляр Unity
        window.unityInstance = unity;
        
        // --- КЛЮЧЕВОЕ ИЗМЕНЕНИЕ ---
        // Теперь, когда мы уверены, что Unity и JS-окружение готовы,
        // мы даем команду Unity начать процесс инициализации.
        // Имя объекта 'ServerManager' и метода 'OnUnityReady' должны совпадать с C#.
        unity.SendMessage('ServerManager', 'OnUnityReady');
        
      }).catch((error) => {
        console.error("Unity не смог загрузиться:", error);
      });
    </script>
  </body>
</html>